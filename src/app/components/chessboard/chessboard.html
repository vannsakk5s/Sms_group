<div class="flex flex-col items-center justify-center min-h-screen p-4 transition-colors duration-300 bg-slate-100 dark:bg-slate-900 text-slate-900 dark:text-white">
  
  <div class="w-full max-w-[480px] mb-2 flex items-center justify-between p-3 rounded-t-xl border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 shadow-sm">
    <div class="flex items-center gap-3">
      <img src="assets/images/opponent.png" class="w-10 h-10 rounded-full border border-slate-300 dark:border-slate-600">
      <div>
        <p class="font-bold text-sm sm:text-base">គូប្រកួត ({{ mySide() === 'w' ? 'Black' : 'White' }})</p>
        @if (turn() !== mySide()) {
          <p class="text-[10px] text-amber-600 dark:text-yellow-500 font-medium animate-pulse">កំពុងគិត...</p>
        }
        
      </div>
    </div>
  </div>

  <div class="grid grid-cols-8 border-4 border-slate-300 dark:border-slate-800 overflow-hidden shadow-2xl"
       [class.flipped-board]="mySide() === 'b'">
    @for (row of board(); track $index; let r = $index) {
      @for (square of row; track $index; let c = $index) {
        <div (click)="handleSquareClick(r, c)"
             [class.bg-[#ebecd0]]="(r + c) % 2 === 0"
             [class.bg-[#779556]]="(r + c) % 2 !== 0"
             class="relative w-11 h-11 sm:w-16 sm:h-16 md:w-20 md:h-20 flex items-center justify-center cursor-pointer">
          
          @if (square) {
            <span [class.text-white]="square.color === 'w'" 
                  [class.text-slate-950]="square.color === 'b'"
                  class="piece-icon z-10 text-4xl sm:text-6xl select-none drop-shadow-sm">
              {{ getPieceIcon(square.type, square.color) }}
            </span>
          }

          @if (selectedSquare() === toAlgebraic(r,c)) {
            <div class="absolute inset-0 bg-yellow-400/50"></div>
          }
          
          @if (possibleMoves().includes(toAlgebraic(r, c))) {
            <div class="absolute w-4 h-4 bg-black/20 rounded-full z-20"></div>
          }
          
        </div>
      }
    }
  </div>

  <div class="w-full max-w-[480px] mt-2 flex items-center justify-between p-3 rounded-b-xl border bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 shadow-sm"
       [class.ring-2]="turn() === mySide()" 
       [class.ring-blue-500]="turn() === mySide()">
    <div class="flex items-center gap-3">
      <div class="relative">
        <img src="assets/images/me.png" class="w-12 h-12 rounded-full border-2 border-blue-500 bg-slate-200">
        @if (turn() == mySide()){
         <div class="absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full border-2 border-white dark:border-slate-800"></div> 
        }
        
      </div>
      <div>
        <p class="font-bold text-sm sm:text-base">អ្នក ({{ mySide() === 'w' ? 'White' : 'Black' }})</p>
        @if (turn() == mySide()){
          <p class="text-[10px] text-blue-600 dark:text-blue-400 font-bold uppercase tracking-wider">● វេនរបស់អ្នក</p>
        }
        
      </div>
    </div>
    <div class="text-right">
      <p class="text-[10px] text-slate-500 dark:text-slate-400 font-semibold">ស្ថានភាព</p>
      <p class="text-xs font-bold text-green-600 dark:text-green-400">{{ gameStatus() }}</p>
    </div>
  </div>
</div>